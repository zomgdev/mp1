# Реализованный функционал

## Backend (Go)

1. Запуск HTTP-сервера на `:8080` со статической раздачей каталога `front/`.
2. API `GET /api/tree`:
   - читает дерево навигации из `data/front/mainmenu.js`;
   - возвращает JSON-структуру дерева;
   - ограничивает метод только `GET`.
3. API `GET /api/scheme/current`:
   - читает текущую схему из `data/front/tools/scheme_editor/current_scheme.json`;
   - если файла нет, возвращает схему по умолчанию (`nodes`, `links`, `nextEntityId`, `nextLinkNo`).
4. API `POST /api/scheme/current`:
   - принимает JSON схемы;
   - нормализует обязательные поля схемы;
   - сохраняет схему на диск;
   - ограничивает размер тела запроса (1 MB);
   - ограничивает методы `GET/POST`.
5. Разделение backend по слоям:
   - `internal/httpapi` (роутинг и обработчики);
   - `internal/storage/filejson` (чтение/запись JSON в файлы);
   - `internal/model` (модели и нормализация данных).

## Frontend (Навигация)

1. Главная страница с двумя зонами:
   - дерево навигации слева;
   - контентная область справа.
2. Загрузка дерева через `GET /api/tree` с fallback на встроенные данные при ошибке API.
3. Отрисовка древовидного меню:
   - раскрытие/сворачивание папок;
   - выбор элементов;
   - подсветка выбранного файла.
4. Контент-роутинг:
   - для большинства узлов показывается базовая карточка выбранного пункта;
   - для узла `Infra layer` встраивается инструмент `tools/scheme_editor/index.html` через `iframe`.
5. `fallback.js` для работы интерфейса навигации, если модульный JS не загрузился.

## Frontend (Редактор схемы / ER)

1. Загрузка схемы с сервера через `GET /api/scheme/current`.
2. Автосохранение схемы через `POST /api/scheme/current`:
   - отложенное сохранение (debounce);
   - защита от параллельных сохранений;
   - попытка сохранить при закрытии вкладки через `sendBeacon`.
3. Инструменты редактора:
   - `Select` (выбор/перемещение);
   - `Entity` (добавление сущности кликом);
   - `Link` (создание связи двумя кликами).
4. Работа с холстом:
   - панорамирование правой кнопкой мыши;
   - масштабирование колесом;
   - фон в виде точечной сетки.
5. Работа с сущностями:
   - добавление сущности с авто-ID;
   - редактирование заголовка и полей;
   - редактор сущности (модальное окно);
   - редактирование одного поля по двойному клику;
   - панель свойств справа (координаты, размеры, поля и т.д.).
6. Работа со связями:
   - прямые линии между сущностями;
   - кардинальности в нотации Crow’s Foot (`one`, `many`, `zero-one`);
   - авто-нумерация связей;
   - выделение связи по клику;
   - удаление связи двойным кликом.
7. Вычисление и отображение транзитивных `References` для сущностей.
8. Подсветка связанного пути при клике по элементам `References`.
9. Внешнее управление выделением связей:
   - через `postMessage` (`select-link`, `clear-link-selection`);
   - через `window.schemeEditor` (`selectLinkById`, `selectLinkByTitles`, `selectLinkByLabel`, `clearLinkSelection`).
10. Горячие клавиши:
   - `1/2/3` для переключения инструмента;
   - `Esc` для отмены создания связи, закрытия редактора и очистки выделения.
11. Встроенная справка по работе редактора.
